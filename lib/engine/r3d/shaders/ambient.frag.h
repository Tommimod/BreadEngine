#ifndef AMBIENT_FRAG_H
#define AMBIENT_FRAG_H

#ifdef __cplusplus
extern "C" {
#endif

static const char AMBIENT_FRAG[] = "#version 330 core\n#define M_PI 3.1415926535897931\n#define M_TAU 6.2831853071795862\n#define M_INV_PI .3183098861837907\nvec3 M_Rotate3D(vec3 v,vec4 q){vec3 t=2.*cross(q.xyz,v);return v+q.w*t+cross(q.xyz,t);}mat3 M_OrthonormalBasis(vec3 n){float sgn=n.z>=0.?1.:-1.;float a=-1./(sgn+n.z);float b=n.x*n.y*a;vec3 t=vec3(1.+sgn*n.x*n.x*a,sgn*b,-sgn*n.x);vec3 bt=vec3(b,sgn+n.y*n.y*a,-n.y);return mat3(t,bt,n);}vec2 M_OctahedronWrap(vec2 val){return(1.-abs(val.yx))*mix(vec2(-1.),vec2(1.),vec2(greaterThanEqual(val.xy,vec2(0.))));}vec3 M_DecodeOctahedral(vec2 encoded){encoded=encoded*2.-1.;vec3 normal;normal.z=1.-abs(encoded.x)-abs(encoded.y);normal.xy=normal.z>=0.?encoded.xy:M_OctahedronWrap(encoded.xy);return normalize(normal);}vec2 M_EncodeOctahedral(vec3 normal){normal/=abs(normal.x)+abs(normal.y)+abs(normal.z);normal.xy=normal.z>=0.?normal.xy:M_OctahedronWrap(normal.xy);normal.xy=normal.xy*.5+.5;return normal.xy;}vec3 M_NormalScale(vec3 normal,float scale){normal.xy*=scale;normal.z=sqrt(1.-clamp(dot(normal.xy,normal.xy),0.,1.));return normal;}float M_HashIGN(vec2 pos){const vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(pos,magic.xy)));}float PBR_DistributionGGX(float cosTheta,float alpha){float a=cosTheta*alpha;float k=alpha/(1.-cosTheta*cosTheta+a*a);return k*k*(1./M_PI);}float PBR_GeometryGGX(float NdotL,float NdotV,float roughness){return .5/mix(2.*NdotL*NdotV,NdotL+NdotV,roughness);}float PBR_SchlickFresnel(float u){float m=1.-u;float m2=m*m;return m2*m2*m;}vec3 PBR_ComputeF0(float metallic,float specular,vec3 albedo){float dielectric=.16*specular*specular;return mix(vec3(dielectric),albedo,vec3(metallic));\n}\n#ifdef IBL\nvec3 IBL_FresnelSchlickRoughness(float cosTheta,vec3 F0,float roughness){return F0+(max(vec3(1.-roughness),F0)-F0)*pow(clamp(1.-cosTheta,0.,1.),5.);}float IBL_GetSpecularMipLevel(float roughness,float numMips){return roughness*roughness*(numMips-1.);}float IBL_GetSpecularOcclusion(float NdotV,float ao,float roughness){return clamp(pow(NdotV+ao,exp2(-16.*roughness-1.))-1.+ao,0.,1.);}vec3 IBL_GetMultiScatterBRDF(sampler2D brdfLut,float NdotV,float roughness,vec3 F0,float metalness){vec2 brdf=texture(brdfLut,vec2(NdotV,roughness)).rg;vec3 FssEss=F0*brdf.x+brdf.y;float Ess=brdf.x+brdf.y;float Ems=1.-Ess;vec3 Favg=mix(F0+(1.-F0)/21.,F0,metalness);vec3 Fms=FssEss*Favg/(1.-Favg*Ems+1e-5);float msStrength=mix(1.,.8,metalness);return FssEss+Fms*Ems*msStrength;}noperspective in vec2 vTexCoord;uniform sampler2D uTexAlbedo;uniform sampler2D uTexNormal;uniform sampler2D uTexDepth;uniform sampler2D uTexSSAO;uniform sampler2D uTexORM;uniform samplerCube uCubeIrradiance;uniform samplerCube uCubePrefilter;uniform sampler2D uTexBrdfLut;uniform vec4 uQuatSkybox;uniform float uSkyboxAmbientIntensity;uniform float uSkyboxReflectIntensity;uniform float uSSAOPower;uniform vec3 uViewPosition;uniform mat4 uMatInvProj;uniform mat4 uMatInvView;layout(location=0)out vec3 FragDiffuse;layout(location=1)out vec3 FragSpecular;vec3 GetPositionFromDepth(float depth){vec4 ndcPos=vec4(vTexCoord*2.-1.,depth*2.-1.,1.);vec4 viewPos=uMatInvProj*ndcPos;viewPos/=viewPos.w;return(uMatInvView*viewPos).xyz;}void main(){vec3 albedo=texture(uTexAlbedo,vTexCoord).rgb;vec3 orm=texture(uTexORM,vTexCoord).rgb;float occlusion=orm.r;float roughness=orm.g;float metalness=orm.b;float ssao=texture(uTexSSAO,vTexCoord).r;if(uSSAOPower!=1.){ssao=pow(ssao,uSSAOPower);}occlusion*=ssao;vec3 F0=PBR_ComputeF0(metalness,.5,albedo);float depth=texture(uTexDepth,vTexCoord).r;vec3 position=GetPositionFromDepth(depth);vec3 N=M_DecodeOctahedral(texture(uTexNormal,vTexCoord).rg);vec3 V=normalize(uViewPosition-position);float NdotV=max(dot(N,V),0.);vec3 kS=IBL_FresnelSchlickRoughness(NdotV,F0,roughness);vec3 kD=(1.-kS)*(1.-metalness);vec3 Nr=M_Rotate3D(N,uQuatSkybox);FragDiffuse=kD*texture(uCubeIrradiance,Nr).rgb;FragDiffuse*=occlusion*uSkyboxAmbientIntensity;vec3 R=M_Rotate3D(reflect(-V,N),uQuatSkybox);const float MAX_REFLECTION_LOD=7.;float mipLevel=IBL_GetSpecularMipLevel(roughness,MAX_REFLECTION_LOD+1.);vec3 prefilteredColor=textureLod(uCubePrefilter,R,mipLevel).rgb;float specularOcclusion=IBL_GetSpecularOcclusion(NdotV,occlusion,roughness);vec3 specularBRDF=IBL_GetMultiScatterBRDF(uTexBrdfLut,NdotV,roughness,F0,metalness);vec3 specular=prefilteredColor*specularBRDF*specularOcclusion;float edgeFade=mix(1.,pow(NdotV,.5),roughness);specular*=edgeFade;FragSpecular=specular*uSkyboxReflectIntensity;\n}\n#else\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexAlbedo;uniform sampler2D uTexSSAO;uniform sampler2D uTexORM;uniform vec3 uAmbientLight;uniform float uSSAOPower;layout(location=0)out vec4 FragDiffuse;void main(){vec3 albedo=texture(uTexAlbedo,vTexCoord).rgb;vec3 orm=texture(uTexORM,vTexCoord).rgb;float occlusion=orm.r;float roughness=orm.g;float metalness=orm.b;float ssao=texture(uTexSSAO,vTexCoord).r;if(uSSAOPower!=1.){ssao=pow(ssao,uSSAOPower);}occlusion*=ssao;vec3 F0=PBR_ComputeF0(metalness,.5,albedo);vec3 kD=(1.-F0)*(1.-metalness);vec3 ambient=kD*uAmbientLight;ambient+=F0*uAmbientLight;ambient*=occlusion;FragDiffuse=vec4(ambient,1.);\n}\n#endif";

#define AMBIENT_FRAG_SIZE 5123

#ifdef __cplusplus
}
#endif

#endif // AMBIENT_FRAG_H
