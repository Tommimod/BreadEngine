#ifndef GEOMETRY_VERT_H
#define GEOMETRY_VERT_H

#ifdef __cplusplus
extern "C" {
#endif

static const char GEOMETRY_VERT[] = "#version 330 core\n#define BILLBOARD_NONE 0\n#define BILLBOARD_FRONT 1\n#define BILLBOARD_Y_AXIS 2\nvoid BillboardFront(inout mat4 model,mat4 invView){float scaleX=length(vec3(model[0]));float scaleY=length(vec3(model[1]));float scaleZ=length(vec3(model[2]));model[0]=vec4(invView[0].xyz*scaleX,0.);model[1]=vec4(invView[1].xyz*scaleY,0.);model[2]=vec4(invView[2].xyz*scaleZ,0.);}void BillboardFront(inout mat4 model,inout mat3 normal,mat4 invView){float scaleX=length(vec3(model[0]));float scaleY=length(vec3(model[1]));float scaleZ=length(vec3(model[2]));model[0]=vec4(invView[0].xyz*scaleX,0.);model[1]=vec4(invView[1].xyz*scaleY,0.);model[2]=vec4(invView[2].xyz*scaleZ,0.);normal[0]=invView[0].xyz;normal[1]=invView[1].xyz;normal[2]=invView[2].xyz;}void BillboardYAxis(inout mat4 model,mat4 invView){vec3 position=vec3(model[3]);float scaleX=length(vec3(model[0]));float scaleY=length(vec3(model[1]));float scaleZ=length(vec3(model[2]));vec3 upVector=normalize(vec3(model[1]));vec3 lookDirection=normalize(vec3(invView[3])-position);vec3 rightVector=normalize(cross(upVector,lookDirection));vec3 frontVector=normalize(cross(rightVector,upVector));model[0]=vec4(rightVector*scaleX,0.);model[1]=vec4(upVector*scaleY,0.);model[2]=vec4(frontVector*scaleZ,0.);}void BillboardYAxis(inout mat4 model,inout mat3 normal,mat4 invView){vec3 position=vec3(model[3]);float scaleX=length(vec3(model[0]));float scaleY=length(vec3(model[1]));float scaleZ=length(vec3(model[2]));vec3 upVector=normalize(vec3(model[1]));vec3 lookDirection=normalize(vec3(invView[3])-position);vec3 rightVector=normalize(cross(upVector,lookDirection));vec3 frontVector=normalize(cross(rightVector,upVector));model[0]=vec4(rightVector*scaleX,0.);model[1]=vec4(upVector*scaleY,0.);model[2]=vec4(frontVector*scaleZ,0.);normal[0]=rightVector;normal[1]=upVector;normal[2]=frontVector;}layout(location=0)in vec3 aPosition;layout(location=1)in vec2 aTexCoord;layout(location=2)in vec3 aNormal;layout(location=3)in vec4 aColor;layout(location=4)in vec4 aTangent;layout(location=5)in ivec4 aBoneIDs;layout(location=6)in vec4 aWeights;layout(location=10)in mat4 iMatModel;layout(location=14)in vec4 iColor;uniform sampler1D uTexBoneMatrices;uniform mat4 uMatInvView;uniform mat4 uMatNormal;uniform mat4 uMatModel;uniform mat4 uMatVP;uniform vec4 uAlbedoColor;uniform float uEmissionEnergy;uniform vec3 uEmissionColor;uniform vec2 uTexCoordOffset;uniform vec2 uTexCoordScale;uniform bool uInstancing;uniform bool uSkinning;uniform int uBillboard;flat out vec3 vEmission;out vec2 vTexCoord;out vec4 vColor;out mat3 vTBN;mat4 BoneMatrix(int boneID){int baseIndex=4*boneID;vec4 row0=texelFetch(uTexBoneMatrices,baseIndex+0,0);vec4 row1=texelFetch(uTexBoneMatrices,baseIndex+1,0);vec4 row2=texelFetch(uTexBoneMatrices,baseIndex+2,0);vec4 row3=texelFetch(uTexBoneMatrices,baseIndex+3,0);return transpose(mat4(row0,row1,row2,row3));}mat4 SkinMatrix(ivec4 boneIDs,vec4 weights){return weights.x*BoneMatrix(boneIDs.x)+weights.y*BoneMatrix(boneIDs.y)+weights.z*BoneMatrix(boneIDs.z)+weights.w*BoneMatrix(boneIDs.w);}void main(){mat4 matModel=uMatModel;mat3 matNormal=mat3(uMatNormal);if(uSkinning){mat4 sMatModel=SkinMatrix(aBoneIDs,aWeights);matModel=matModel*sMatModel;matNormal=matNormal*mat3(transpose(inverse(sMatModel)));}if(uInstancing){matModel=transpose(iMatModel)*matModel;matNormal=mat3(transpose(inverse(iMatModel)))*matNormal;}switch(uBillboard){case BILLBOARD_NONE:break;case BILLBOARD_FRONT:BillboardFront(matModel,matNormal,uMatInvView);break;case BILLBOARD_Y_AXIS:BillboardYAxis(matModel,matNormal,uMatInvView);break;}vec3 T=normalize(matNormal*aTangent.xyz);vec3 N=normalize(matNormal*aNormal);vec3 B=normalize(cross(N,T)*aTangent.w);vec3 position=vec3(matModel*vec4(aPosition,1.));vTexCoord=uTexCoordOffset+aTexCoord*uTexCoordScale;vEmission=uEmissionColor*uEmissionEnergy;vColor=aColor*iColor*uAlbedoColor;vTBN=mat3(T,B,N);gl_Position=uMatVP*vec4(position,1.);}";

#define GEOMETRY_VERT_SIZE 3925

#ifdef __cplusplus
}
#endif

#endif // GEOMETRY_VERT_H
